<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0, user-scalable=yes">
    <title>Galaxy Quest: IR Edition</title>
    <style>
        :root {
            --primary: #a465ff;
            --bg: #050505;
            --danger: #ff4444;
        }

        body {
            margin: 0;
            background: var(--bg);
            color: white;
            font-family: 'Segoe UI', Tahoma, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden; 
            height: 100vh;
            width: 100vw;
            -webkit-tap-highlight-color: transparent;
        }

        /* Maximized Container */
        #main-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            z-index: 10;
        }

        #infoBar {
            display: flex;
            justify-content: space-between;
            padding: 10px 15px;
            font-size: 16px;
            font-weight: bold;
            background: rgba(0,0,0,0.5);
        }

        .stat-box { 
            background: #111; 
            padding: 4px 12px; 
            border: 1px solid #444; 
            border-radius: 4px; 
        }

        #gameArea {
            position: relative;
            flex-grow: 1; /* Takes up all remaining vertical space */
            width: 100%;
            background: black;
            overflow: hidden;
        }

        canvas {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Ensures it fills the space like a full-screen app */
            display: block;
            touch-action: none;
            background: radial-gradient(circle at bottom, #1b0030 0%, #000 100%);
        }

        /* Large Mobile Controls */
        #mobile-controls {
            display: flex;
            position: absolute;
            bottom: 40px;
            left: 0;
            width: 100%;
            justify-content: space-between;
            padding: 0 20px;
            box-sizing: border-box;
            z-index: 100;
            pointer-events: none;
        }

        .d-pad, .action-pad { pointer-events: auto; display: flex; gap: 15px; }

        .ctrl-btn {
            width: 85px;
            height: 85px;
            background: rgba(164, 101, 255, 0.25);
            border: 2px solid var(--primary);
            border-radius: 50%;
            color: white;
            font-size: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            user-select: none;
            box-shadow: 0 0 15px rgba(164, 101, 255, 0.3);
        }

        #fireBtn {
            background: rgba(255, 68, 68, 0.35);
            border-color: var(--danger);
            width: 100px;
            height: 100px;
            font-weight: bold;
            font-size: 20px;
            box-shadow: 0 0 15px rgba(255, 68, 68, 0.3);
        }

        .ctrl-btn:active { background: rgba(164, 101, 255, 0.6); transform: scale(0.95); }
        #fireBtn:active { background: rgba(255, 68, 68, 0.7); }

        /* Overlays - Centered and Full Size */
        #startScreen, #quizBox {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.92);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 200;
            padding: 30px;
            box-sizing: border-box;
        }

        .instructions {
            text-align: left;
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #555;
            font-size: 15px;
            line-height: 1.6;
        }

        .start-btn { 
            padding: 15px 50px; 
            background: var(--primary); 
            border: none; 
            color: white; 
            font-weight: bold; 
            border-radius: 5px; 
            font-size: 18px;
        }

        #options button {
            width: 100%; margin: 10px 0; padding: 16px;
            background: #222; color: white; border: 1px solid #555; border-radius: 6px;
            font-size: 16px;
        }
    </style>
</head>
<body>

<div id="main-container">
    <div id="infoBar">
        <div class="stat-box">Score: <span id="score">0</span></div>
        <div class="stat-box" style="color: var(--danger);">Shields: <span id="lives">5</span></div>
    </div>

    <div id="gameArea">
        <canvas id="game" width="600" height="400"></canvas>
        
        <div id="startScreen">
            <h2 style="color: var(--primary); font-size: 28px; margin-top:0;">GALAXY QUEST</h2>
            <ul class="instructions">
                <li>‚¨ÖÔ∏è ‚û°Ô∏è <b>Move Ship</b></li>
                <li>üöÄ <b>FIRE Lasers</b></li>
                <li>üí• Destroy asteroids to trigger <b>Questions</b></li>
                <li>üõ°Ô∏è Avoid crashing! <b>5 Lives</b></li>
            </ul>
            <input type="text" id="playerNameInput" placeholder="Enter Pilot Name" maxlength="12" style="padding:12px; margin-bottom:20px; border: 2px solid var(--primary); background: #000; color: white; text-align: center; width: 80%;">
            <button class="start-btn" onclick="startGame()">ENGAGE</button>
        </div>

        <div id="quizBox" style="display: none;">
            <p id="question" style="text-align: center; font-size: 1.2em; line-height: 1.5; color: #eee;"></p>
            <div id="options" style="width: 100%;"></div>
        </div>
    </div>
</div>

<div id="mobile-controls">
    <div class="d-pad">
        <div id="leftBtn" class="ctrl-btn">‚óÄ</div>
        <div id="rightBtn" class="ctrl-btn">‚ñ∂</div>
    </div>
    <div class="action-pad">
        <div id="fireBtn" class="ctrl-btn">FIRE</div>
    </div>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// --- STATE ---
let ship = { x: 280, y: 340, w: 40, h: 20 };
let lasers = [], asteroids = [], stars = [], keys = {};
let score = 0, lives = 5, gameActive = false, gamePaused = false;

for(let i=0; i<100; i++) stars.push({ x: Math.random()*600, y: Math.random()*400, s: Math.random()*2 });

const questions = [
    { word: "Realism", def: "A theory that views states as rational actors pursuing power and survival in an anarchic international system." },
    { word: "Liberalism", def: "A theory that emphasises cooperation, institutions, democracy, and economic interdependence in reducing conflict." },
    { word: "Constructivism", def: "A theory arguing that international politics is shaped by ideas, norms, identities, and social interactions." },
    { word: "Neorealism", def: "A realist theory that explains state behaviour primarily through the structure of the international system, especially anarchy." },
    { word: "Neoliberal Institutionalism", def: "A theory that argues international institutions facilitate cooperation even under anarchy." },
    { word: "Anarchy", def: "The absence of a central authority above states in international politics." },
    { word: "Balance of Power", def: "A situation where power is distributed among states so that no single state dominates others." },
    { word: "Security Dilemma", def: "A situation where one state‚Äôs defensive actions increase insecurity in other states, leading to escalation." },
    { word: "National Interest", def: "A state‚Äôs primary goals and objectives in foreign policy, usually centred on security and prosperity." },
    { word: "State Sovereignty", def: "The principle that a state has supreme authority over its territory and domestic affairs." },
    { word: "Hard Power", def: "The use of military force or economic pressure to influence other states." },
    { word: "Soft Power", def: "The ability to influence others through attraction, culture, values, and diplomacy." },
    { word: "Smart Power", def: "The strategic combination of hard power and soft power." },
    { word: "Deterrence", def: "The prevention of aggression by threatening unacceptable retaliation." },
    { word: "Coercive Diplomacy", def: "The use of threats or limited force to persuade a state to change its behaviour." },
    { word: "Diplomacy", def: "The management of international relations through negotiation and dialogue." },
    { word: "Economic Sanctions", def: "The use of trade or financial restrictions to pressure a state into changing its policies." },
    { word: "Military Intervention", def: "The use of armed force by a state in another state‚Äôs territory." },
    { word: "Foreign Aid", def: "Financial, technical, or humanitarian assistance given to another country." },
    { word: "Proxy War", def: "A conflict in which major powers support opposing sides without direct confrontation." },
    { word: "Collective Security", def: "A system where states agree to respond collectively to threats against any member." },
    { word: "Multilateralism", def: "Cooperation among three or more states on shared issues." },
    { word: "Bilateralism", def: "Cooperation or agreements between two states." },
    { word: "Alliance", def: "A formal agreement between states for mutual support, often military." },
    { word: "Non-Alignment", def: "A foreign policy stance of not formally aligning with major power blocs." },
    { word: "International Law", def: "A set of rules and norms governing relations between states." },
    { word: "Humanitarian Intervention", def: "The use of force to prevent or stop widespread human rights abuses." },
    { word: "R2P (Responsibility to Protect)", def: "The principle that states must protect populations from mass atrocities, and the international community may intervene if they fail." },
    { word: "Global Governance", def: "The collective management of global issues through international institutions and norms." },
    { word: "Nationalism", def: "A belief that prioritises the interests, culture, and identity of one‚Äôs nation, often above others." }
];

// --- MOBILE TOUCH ---
const setupBtn = (id, keyCode) => {
    const el = document.getElementById(id);
    el.addEventListener("touchstart", (e) => { e.preventDefault(); keys[keyCode] = true; });
    el.addEventListener("touchend", (e) => { e.preventDefault(); keys[keyCode] = false; });
};
setupBtn("leftBtn", "ArrowLeft");
setupBtn("rightBtn", "ArrowRight");
document.getElementById("fireBtn").addEventListener("touchstart", (e) => {
    e.preventDefault(); if(gameActive && !gamePaused) shoot();
});

window.addEventListener("keydown", e => {
    keys[e.code] = true;
    if(e.code === "Space" && gameActive && !gamePaused) shoot();
});
window.addEventListener("keyup", e => keys[e.code] = false);

function shoot() {
    if(lasers.length < 8) lasers.push({ x: ship.x + 18, y: ship.y });
}

function startGame() {
    document.getElementById("startScreen").style.display = "none";
    score = 0; lives = 5; asteroids = []; lasers = [];
    gameActive = true; gamePaused = false;
    gameLoop();
}

function update() {
    if(!gameActive || gamePaused) return;

    if (keys["ArrowLeft"] && ship.x > 0) ship.x -= 7;
    if (keys["ArrowRight"] && ship.x < canvas.width - ship.w) ship.x += 7;

    lasers.forEach((l, i) => { l.y -= 8; if(l.y < -10) lasers.splice(i, 1); });
    stars.forEach(s => { s.y += 0.5; if(s.y > 400) s.y = 0; });

    if(Math.random() < 0.018) {
        asteroids.push({ x: Math.random() * 560, y: -30, size: 30 });
    }

    asteroids.forEach((a, ai) => {
        a.y += 2.8;
        lasers.forEach((l, li) => {
            if(rectIntersect(l.x, l.y, 4, 10, a.x, a.y, a.size, a.size)) {
                lasers.splice(li, 1);
                asteroids.splice(ai, 1);
                triggerQuiz();
            }
        });
        if(rectIntersect(ship.x, ship.y, ship.w, ship.h, a.x, a.y, a.size, a.size)) {
            asteroids.splice(ai, 1);
            lives--;
            if(lives <= 0) endGame();
        }
    });
}

function rectIntersect(x1, y1, w1, h1, x2, y2, w2, h2) {
    return x2 < x1 + w1 && x2 + w2 > x1 && y2 < y1 + h1 && y2 + h2 > y1;
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "white";
    stars.forEach(s => ctx.fillRect(s.x, s.y, s.s, s.s));

    // ORIGINAL SHIP DESIGN
    ctx.fillStyle = "#a465ff";
    ctx.shadowBlur = 10;
    ctx.shadowColor = "#a465ff";
    ctx.fillRect(ship.x, ship.y, ship.w, ship.h); 
    ctx.fillStyle = "white";
    ctx.fillRect(ship.x + 15, ship.y - 5, 10, 5); 
    ctx.shadowBlur = 0;

    ctx.fillStyle = "#ff0";
    lasers.forEach(l => ctx.fillRect(l.x, l.y, 4, 10));

    ctx.fillStyle = "#888";
    asteroids.forEach(a => {
        ctx.fillRect(a.x, a.y, a.size, a.size);
        ctx.fillStyle = "#aaa"; 
        ctx.fillRect(a.x + 5, a.y + 5, 5, 5);
        ctx.fillStyle = "#888";     
    });
    
    document.getElementById("score").textContent = score;
    document.getElementById("lives").textContent = lives;
}

function triggerQuiz() {
    gamePaused = true;
    const q = questions[Math.floor(Math.random() * questions.length)];
    document.getElementById("question").innerHTML = `<b>Match the Term:</b><br><br>"${q.def}"`;
    const opts = document.getElementById("options");
    opts.innerHTML = "";
    
    let choices = [q.word];
    while(choices.length < 4) {
        let rw = questions[Math.floor(Math.random() * questions.length)].word;
        if(!choices.includes(rw)) choices.push(rw);
    }
    choices.sort(() => Math.random() - 0.5);

    choices.forEach(choice => {
        const btn = document.createElement("button");
        btn.textContent = choice;
        btn.onclick = () => {
            if (choice === q.word) score++;
            document.getElementById("quizBox").style.display = "none";
            gamePaused = false;
        };
        opts.appendChild(btn);
    });
    document.getElementById("quizBox").style.display = "flex";
}

function endGame() {
    gameActive = false;
    alert("Mission Failure! Final Score: " + score);
    location.reload();
}

function gameLoop() {
    if (!gameActive) return;
    update();
    draw();
    requestAnimationFrame(gameLoop);
}
</script>
</body>
</html>
